<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .container {
      background: white;
      border-radius: 10px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      max-width: 600px;
      width: 100%;
      padding: 40px;
    }
    
    h1 {
      color: #667eea;
      margin-bottom: 10px;
      text-align: center;
    }
    
    h2 {
      color: #444;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
    }
    
    input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 2px solid #ddd;
      border-radius: 5px;
      font-size: 16px;
    }
    
    input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    button {
      width: 100%;
      padding: 12px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-bottom: 10px;
    }
    
    button:hover {
      background: #764ba2;
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .btn-secondary {
      background: #34a853;
    }
    
    .btn-secondary:hover {
      background: #2d8e47;
    }
    
    .welcome-box {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 5px;
      margin-bottom: 20px;
      text-align: center;
    }
    
    .request-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 20px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    
    th, td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    
    th {
      background: #f8f9fa;
      font-weight: bold;
    }
    
    .status-pending {
      color: #ff9800;
      font-weight: bold;
    }
    
    .status-approved {
      color: #34a853;
      font-weight: bold;
    }
    
    .status-rejected {
      color: #ea4335;
      font-weight: bold;
    }
    
    .loading {
      text-align: center;
      color: #667eea;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Login Form -->
    <div id="login-form">
      <h1>üèõÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h1>
      <p class="subtitle">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß 13 ‡∏´‡∏•‡∏±‡∏Å</p>
      
      <input type="text" id="id13" placeholder="‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß 13 ‡∏´‡∏•‡∏±‡∏Å" maxlength="13">
      <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
      <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>
    
    <!-- Main Page (Hidden initially) -->
    <div id="main-page" style="display:none;">
      <div class="welcome-box">
        <h2>‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö üë§</h2>
        <h3 id="user-name"></h3>
      </div>
      
      <h3>üìã ‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>
      <div class="request-buttons">
        <button onclick="requestDocument('‡∏Å‡∏û7')">‡∏Å‡∏û.7</button>
        <button onclick="requestDocument('‡∏Å‡∏Ñ‡∏®16')">‡∏Å‡∏Ñ‡∏®.16</button>
      </div>
      
      <button class="btn-secondary" onclick="showMyRequests()">‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
      
      <div id="content"></div>
    </div>
  </div>
  
  <script>
    /**
     * Login
     */
    function login() {
      const id13 = document.getElementById('id13').value.trim();
      const password = document.getElementById('password').value;
      
      if (!id13 || id13.length !== 13) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß 13 ‡∏´‡∏•‡∏±‡∏Å');
        return;
      }
      
      if (!password) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
        return;
      }
      
      showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...');
      
      google.script.run
        .withSuccessHandler(onLoginSuccess)
        .withFailureHandler(onLoginFailure)
        .userLogin(id13, password);
    }
    
    function onLoginSuccess(result) {
      hideLoading();
      
      if (result.success) {
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('main-page').style.display = 'block';
        document.getElementById('user-name').textContent = result.userName;
      } else {
        alert('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + result.message);
      }
    }
    
    function onLoginFailure(error) {
      hideLoading();
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
    }
    
    /**
     * ‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
     */
    function requestDocument(documentType) {
      if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ' + documentType + '?')) {
        return;
      }
      
      showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠...');
      
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          alert(result.message);
          if (result.success) {
            showMyRequests();
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
        })
        .createDocumentRequest(documentType);
    }
    
    /**
     * ‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
     */
    function showMyRequests() {
      showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
      
      google.script.run
        .withSuccessHandler(displayRequests)
        .withFailureHandler(function(error) {
          hideLoading();
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
        })
        .getUserRequests();
    }
    
    function displayRequests(requests) {
      hideLoading();
      
      let html = '<h3>‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h3>';
      
      if (requests.length === 0) {
        html += '<p style="text-align:center; color:#666;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠</p>';
      } else {
        html += '<table>';
        html += '<tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>';
        
        requests.forEach(function(req) {
          html += '<tr>';
          html += '<td>' + req.document_type + '</td>';
          html += '<td>' + formatDate(req.request_date) + '</td>';
          html += '<td class="status-' + req.status + '">' + getStatusText(req.status) + '</td>';
          html += '<td>';
          
          if (req.status === 'approved' && req.file_url) {
            html += '<button onclick="downloadFile(\'' + req.file_url + '\')">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>';
          } else if (req.status === 'rejected') {
            html += '<button onclick="showRejectionReason(\'' + (req.rejection_reason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '\')">‡∏î‡∏π‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•</button>';
          } else {
            html += '<span style="color:#999;">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>';
          }
          
          html += '</td>';
          html += '</tr>';
        });
        
        html += '</table>';
      }
      
      document.getElementById('content').innerHTML = html;
    }
    
    function downloadFile(fileUrl) {
      window.open(fileUrl, '_blank');
    }
    
    function showRejectionReason(reason) {
      alert('‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:\n' + reason);
    }
    
    /**
     * Helper Functions
     */
    function getStatusText(status) {
      const statusMap = {
        'pending': '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥',
        'approved': '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß',
        'rejected': '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò'
      };
      return statusMap[status] || status;
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('th-TH', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    function showLoading(message) {
      const content = document.getElementById('content');
      if (content) {
        content.innerHTML = '<div class="loading">' + message + '</div>';
      }
    }
    
    function hideLoading() {
      // Loading will be replaced by actual content
    }
  </script>
</body>
</html>
