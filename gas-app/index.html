<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</title>
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'sarabun': ['Sarabun', 'sans-serif'],
          },
        },
      },
    }
  </script>
  
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen flex items-center justify-center p-4">
  <div class="w-full max-w-2xl">
    <!-- Login Form -->
    <div id="login-form" class="bg-white rounded-2xl shadow-2xl p-8 md:p-12">
      <div class="text-center mb-8">
        <div class="text-6xl mb-4">üèõÔ∏è</div>
        <h1 class="text-3xl font-bold text-gray-800 mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h1>
        <p class="text-gray-600">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß 13 ‡∏´‡∏•‡∏±‡∏Å</p>
      </div>
      
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß 13 ‡∏´‡∏•‡∏±‡∏Å</label>
          <input 
            type="text" 
            id="id13" 
            maxlength="13"
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:outline-none transition"
            placeholder="1234567890123">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
          <input 
            type="password" 
            id="password"
            class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-indigo-500 focus:ring focus:ring-indigo-200 focus:outline-none transition"
            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
        </div>
        
        <button 
          onclick="login()"
          class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-indigo-700 hover:to-purple-700 transform hover:scale-105 transition duration-200 shadow-lg">
          ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö
        </button>
      </div>
    </div>
    
    <!-- Main Page (Hidden initially) -->
    <div id="main-page" class="hidden">
      <!-- Welcome Card -->
      <div class="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
        <div class="text-center">
          <div class="text-5xl mb-3">üë§</div>
          <h2 class="text-2xl font-bold text-gray-800 mb-1">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö</h2>
          <h3 id="user-name" class="text-xl text-indigo-600 font-semibold"></h3>
        </div>
      </div>
      
      <!-- Request Documents Card -->
      <div class="bg-white rounded-2xl shadow-2xl p-6 md:p-8 mb-6">
        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <span class="text-2xl mr-2">üìã</span>
          ‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
        </h3>
        
        <div class="grid grid-cols-2 gap-4 mb-4">
          <button 
            onclick="requestDocument('‡∏Å‡∏û7')"
            class="bg-gradient-to-r from-blue-500 to-blue-600 text-white font-semibold py-4 px-6 rounded-xl hover:from-blue-600 hover:to-blue-700 transform hover:scale-105 transition duration-200 shadow-lg">
            <div class="text-2xl mb-1">üìÑ</div>
            <div>‡∏Å‡∏û.7</div>
          </button>
          
          <button 
            onclick="requestDocument('‡∏Å‡∏Ñ‡∏®16')"
            class="bg-gradient-to-r from-green-500 to-green-600 text-white font-semibold py-4 px-6 rounded-xl hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition duration-200 shadow-lg">
            <div class="text-2xl mb-1">üìú</div>
            <div>‡∏Å‡∏Ñ‡∏®.16</div>
          </button>
        </div>
        
        <button 
          onclick="showMyRequests()"
          class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white font-semibold py-3 px-6 rounded-xl hover:from-purple-600 hover:to-pink-600 transform hover:scale-105 transition duration-200 shadow-lg">
          üìÇ ‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
        </button>
      </div>
      
      <!-- Content Area -->
      <div id="content"></div>
    </div>
  </div>
  
  <script>
    /**
     * Login
     */
    function login() {
      const id13 = document.getElementById('id13').value.trim();
      const password = document.getElementById('password').value;
      
      if (!id13 || id13.length !== 13) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏•‡∏Ç‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ï‡∏±‡∏ß 13 ‡∏´‡∏•‡∏±‡∏Å');
        return;
      }
      
      if (!password) {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô');
        return;
      }
      
      showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...');
      
      google.script.run
        .withSuccessHandler(onLoginSuccess)
        .withFailureHandler(onLoginFailure)
        .userLogin(id13, password);
    }
    
    function onLoginSuccess(result) {
      hideLoading();
      
      if (result.success) {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('main-page').classList.remove('hidden');
        document.getElementById('user-name').textContent = result.userName;
      } else {
        alert('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + result.message);
      }
    }
    
    function onLoginFailure(error) {
      hideLoading();
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
    }
    
    /**
     * ‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
     */
    function requestDocument(documentType) {
      if (!confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ' + documentType + '?')) {
        return;
      }
      
      showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠...');
      
      google.script.run
        .withSuccessHandler(function(result) {
          hideLoading();
          alert(result.message);
          if (result.success) {
            showMyRequests();
          }
        })
        .withFailureHandler(function(error) {
          hideLoading();
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
        })
        .createDocumentRequest(documentType);
    }
    
    /**
     * ‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô
     */
    function showMyRequests() {
      showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
      
      google.script.run
        .withSuccessHandler(displayRequests)
        .withFailureHandler(function(error) {
          hideLoading();
          alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
        })
        .getUserRequests();
    }
    
    function displayRequests(requests) {
      hideLoading();
      
      let html = '<div class="bg-white rounded-2xl shadow-2xl p-6 md:p-8">';
      html += '<h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">';
      html += '<span class="text-2xl mr-2">üìÇ</span>‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô';
      html += '</h3>';
      
      if (requests.length === 0) {
        html += '<div class="text-center py-12">';
        html += '<div class="text-6xl mb-4">üì≠</div>';
        html += '<p class="text-gray-500 text-lg">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏Ç‡∏≠</p>';
        html += '</div>';
      } else {
        html += '<div class="overflow-x-auto">';
        html += '<table class="w-full">';
        html += '<thead>';
        html += '<tr class="border-b-2 border-gray-200">';
        html += '<th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>';
        html += '<th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>';
        html += '<th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>';
        html += '<th class="text-left py-3 px-4 font-semibold text-gray-700">‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>';
        html += '</tr>';
        html += '</thead>';
        html += '<tbody>';
        
        requests.forEach(function(req) {
          html += '<tr class="border-b border-gray-100 hover:bg-gray-50 transition">';
          html += '<td class="py-3 px-4">';
          html += '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800">';
          html += req.document_type;
          html += '</span>';
          html += '</td>';
          html += '<td class="py-3 px-4 text-gray-600 text-sm">' + formatDate(req.request_date) + '</td>';
          html += '<td class="py-3 px-4">';
          
          if (req.status === 'pending') {
            html += '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-yellow-100 text-yellow-800">';
            html += '‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
          } else if (req.status === 'approved') {
            html += '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">';
            html += '‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß';
          } else if (req.status === 'rejected') {
            html += '<span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800">';
            html += '‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò';
          }
          
          html += '</span>';
          html += '</td>';
          html += '<td class="py-3 px-4">';
          
          if (req.status === 'approved' && req.file_url) {
            html += '<button onclick="downloadFile(\'' + req.file_url + '\')" ';
            html += 'class="bg-gradient-to-r from-green-500 to-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:from-green-600 hover:to-green-700 transition transform hover:scale-105">';
            html += 'üì• ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î';
            html += '</button>';
          } else if (req.status === 'rejected') {
            html += '<button onclick="showRejectionReason(\'' + (req.rejection_reason || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏') + '\')" ';
            html += 'class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-300 transition">';
            html += '‡∏î‡∏π‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•';
            html += '</button>';
          } else {
            html += '<span class="text-gray-400 text-sm">‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</span>';
          }
          
          html += '</td>';
          html += '</tr>';
        });
        
        html += '</tbody>';
        html += '</table>';
        html += '</div>';
      }
      
      html += '</div>';
      document.getElementById('content').innerHTML = html;
    }
    
    function downloadFile(fileUrl) {
      window.open(fileUrl, '_blank');
    }
    
    function showRejectionReason(reason) {
      alert('‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:\n' + reason);
    }
    
    /**
     * Helper Functions
     */
    function getStatusText(status) {
      const statusMap = {
        'pending': '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥',
        'approved': '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß',
        'rejected': '‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò'
      };
      return statusMap[status] || status;
    }
    
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('th-TH', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    function showLoading(message) {
      const content = document.getElementById('content');
      if (content) {
        content.innerHTML = '<div class="flex flex-col items-center justify-center py-12">' +
          '<div class="animate-spin rounded-full h-12 w-12 border-b-4 border-indigo-600 mb-4"></div>' +
          '<p class="text-gray-600 text-lg">' + message + '</p>' +
          '</div>';
      }
    }
    
    function hideLoading() {
      // Loading will be replaced by actual content
    }
  </script>
</body>
</html>
